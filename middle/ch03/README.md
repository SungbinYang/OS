> 이 포스트는 [감자님 강의](https://www.inflearn.com/course/%EB%B9%84%EC%A0%84%EA%B3%B5%EC%9E%90-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/dashboard '인프런 강의')를 기반으로 작성되었습니다.

## 프로세스 간 통신

프로세스는 독립적으로 실행되기도 하지만 다른 프로세스와 데이터를 주고받으며 통신을 하는 경우도 있다. 통신은 한 컴퓨터 내에서 실행되고 있는 다른 프로세스와 할 수도 있고 네트워크로 연결된 다른 컴퓨터에 있는 프로세스와 할 수도 있다.

그럼 프로세스 간 통신의 종류를 알아보자. 첫번째는 한 컴퓨터 내에서 프로세스 간 통신을 하는 방법으로 파일과 파이프를 이용하는 방법이다. 먼저 파일을 이용하는 방법은 통신하려는 프로세스들이 하나의 파일을 이용해 읽고 쓰는 방법이다. 파이프를 이용하는 방법은 운영체제가 생성한 파이프를 이용해 데이터를 읽고 쓰는 방법이다. 두 번째로 쓰레드를 이용하는 방법이 있다. 이 방법은 한 프로세스 내에서 쓰레드들 간 통신을 하는 방법이다. 쓰레드는 코드, 데이터, 힙영역을 공유하고 스택만 각자 자기의 것을 가지고 있다고 했다. 여기서 데이터 영역에 있는 전역변수나 힙을 이용하면 통신이 가능하다. 세 번째로 네트워크를 이용하는 방법이다. 운영체제가 제공하는 소켓통신이나 다른 컴퓨터에 있는 함수를 호출하는 RPC(원격 프로시저 호출)을 이용해 통신하는 방법이 있다.

> 이 포스트는 [감자님 강의](https://www.inflearn.com/course/%EB%B9%84%EC%A0%84%EA%B3%B5%EC%9E%90-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/dashboard '인프런 강의')를 기반으로 작성되었습니다.

## 공유자원과 임계구역

이전 포스트에서 프로세스 간 통신이 가능하다는 것을 알아봤다. 프로세스 간 통신을 할 때 공동으로 이용하는 변수나 파일들이 있는데 이런 것들을 공유자원이라고 한다. 여기서 문제가 발생한다. 공유자원은 여러 프로세스가 공유하고 있기 때문에 각 프로세스의 접근 순서에 따라 어떤 프로세스가 먼저 실행되고 어떤 프로세스가 나중에 실행되는지 예측하기 힘들다. 따라서 연산결과를 예측하기 힘들고 여기서 발생하는 문제를 "**동기화 문제**"라고 부른다.

게임을 예시로 보자. 캐릭터 총체력이 100이고 현재 체력이 20인 상황이라고 하자. 지금은 적에게 공격을 받고 있고 플레이어는 죽지 않기 위해 물약을 먹었다. 이때 물약을 먹는 코드와 적에게 공격받는 코드에서 발생할 수 있는 동기화 문제를 살펴보자.

```c++
int health = 20; // 현재 체력
```

```c++
// 물약을 먹는 코드
int currentHealth = GetHealth();
health = currentHealth + 50; // 체력 50 증가
```

```c++
// 공격 받는 코드
int currentHealth = GetHealth();
health = currentHealth - 10; // 체력 10 감소
```

물약 먹는 코드와 공격 받는 코드가 동시에 실행되었는데 CPU 스케줄러에 의해 공격받는 코드가 먼저 실행되었다고 가정하자. GetHealth()를 호출해서 currentHealth에 20이 저장된다. 여기서 컨텍스트 스위칭을 하여 물약 먹는 코드가 실행되었다고 하자. 물약 먹는 코드에서도 GetHealth()를 통하여 currentHelath에 20이 저장된다. 다음 코드를 실행하여 health 값에 70이 저장된다. 이제 다시 컨텍스트 스위칭을 하여 공격받는 코드가 실행된다. 공격받는 코드의 2번째 줄까지 실행이 되었으니 3번째 줄이 실행되고 health값에는 10이 저장된다. 그래서 결론적으로 60이 저장되어야 한다고 예상을 하지만 결과는 10이 저장된 것이다. 이렇게 결과가 엉망이 된 이유는 health라는 공유자원을 여러 프로세스가 동시에 사용했기 때문이다. 따라서 여러 프로세스가 동시에 사용하면 안 되는 구역을 정의했는데 이를 임계구역이라고 한다. 또한 공유자원을 서로 사용하기 위해 경쟁하는 것을 경쟁조건이라고 한다.

임계구역에서 발생하는 문제를 해결하기 위한 기법의 조건은 무엇일까? 상호배제 메커니즘이 필요한데 조건은 아래와 같은 3가지이다.

> 상호배제 메커니즘 3가지  
> 1\. 주어진 시간에 상상 하나의 프로세스만 임계구역에 접근해야 한다.  
> 2\. 동시에 여러개 요청이 있더라도 하나의 프로세스만 집입하도록 허용해야 한다.  
> 3\. 임계구역에 들어간 프로세스는 최대한 빠르게 나와야 한다. 그렇지 않으면 다른 프로세스들이 오래 기다려야 한다.
