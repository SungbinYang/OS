> 이 포스트는 [감자님 강의](https://www.inflearn.com/course/%EB%B9%84%EC%A0%84%EA%B3%B5%EC%9E%90-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/dashboard '인프런 강의')를 기반으로 작성되었습니다.

## 주변장치(I/O 디바이스, 저장장치)

주변장치에 대해 알아보자. 주변장치는 그래픽 카드, 하드디스크, SSD, 키보드, 마우스 등 여러 가지가 존재한다.

### 주변장치 내부구조

주변장치들은 메인보드에 있는 버스로 연결된다. 실제로 하나의 버스는 Address 버스와 Data 버스, Control 버스로 이루어져 있다. 그래서 I/O 디바이스는 이 3가지 버스를 따로 받을 수 있다. 그리고 각 하드웨어에 맞게 외부 인터페이스가 존재한다. 또 장치의 상태와 데이터를 보관할 수 있는 각 종 레지스터들이 존재한다. 이 레지스터들은 입출력 작업을 할 때 데이터를 보관할 수 있는 각 종 레지스터들이 존재한다. 이 레지스터들은 입출력 작업을 할 때 데이터를 저장하는 역할을 한다. 이 값들은 CPU가 사용되기 위해 메모리로 이동되기도 한다.

### 캐릭터 디바이스와 블록 디바이스

주변장치는 캐릭터 디바이스와 블록 디바이스 두 가지로 나뉠 수 있다. 데이터 전송단위가 캐릭터냐 블록이냐로 나뉜 것이다. 캐릭터 디바이스로는 마우스, 키보드, 사운드 카드, 직렬/병렬 포트 등이 있다. 블록 디바이스는 하드디스크, SSD, 그래픽 카드등이 있다. 캐릭터 디바이스와 블록 디바이스의 특징이 있다. 캐릭터 디바이스는 상대적으로 적은 양의 데이터를 전송하고 블록 디바이스는 많은 양의 데이터를 전송한다.

### 입출력 제어기(I/O Controller)

여러 주변장치는 메인보드 내의 버스로 연결되어 있는데 예전에는 주변장치들을 하나의 버스로 연결해서 사용하였다. CPU가 작업을 하다가 I/O 명령을 만나면 직접 입출력 장치에서 데이터를 가져왔는데 입출력 중에는 다른 작업을 하지 못하기 때문에 CPU 사용률이 떨어졌다. 이를 해결하기 위해 입출력 제어기(I/O Controller)와 여러 개의 버스가 추가되었다. CPU는 I/O 명령을 만나면 입출력 제어기에게 입출력 작업을 맡기고 다른 작업을 실행한다. 입출력 제어기는 2개의 채널, 시스템 버스와 입출력 버스로 구분되었다. 시스템 버스는 고속으로 작동하는 CPU와 메모리가 사용하고 입출력 버스는 주변장치가 사용한다. 입출력 버스는 세부적으로 느린 장치와 빠른 장치를 구분하기 위해 다시 2개의 채널로 나뉘는데 바로 고속 입출력 버스와 저속 입출력 버스이다. 느린 장치와 빠른 장치를 구분해 속도 차이로 인한 병목현상을 해결한 부분이다. 그래픽 카드는 조금 특별한데 그래픽 카드가 다루는 데이터는 매우 대용량이라 고속 입출력 버스로 감당이 안된다. 따라서 그래픽 카드는 입출력 버스에 있지 않고 시스템 버스에 바로 연결해서 사용한다. 입출력 제어기는 여러 주변장치를 처리하는데 입출력 버스에서 온 데이터를 메모리로 옮긴다. 그런데 메모리는 CPU의 명령으로 움직이기 때문에 입출력 제어기가 메모리에 접근하기 위해서 CPU가 필요하다. 입출력 제어기가 CPU의 도움이 없도록 DMA 제어기라는 것이 추가되었다. DMA로 데이터를 직접 메모리에 저장하거나 가져올 수 있다. CPU와 DMA가 사용되는 메모리가 겹치지 않도록 CPU가 사용하는 메모리 영역과 DMA가 사용하는 메모리 영역을 나누는데 이를 Memory Mapped I/O라고 부른다.

> 이 포스트는 [감자님 강의](https://www.inflearn.com/course/%EB%B9%84%EC%A0%84%EA%B3%B5%EC%9E%90-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/dashboard '인프런 강의')를 기반으로 작성되었습니다.

## 마우스 / 키보드

이번 포스트에선 주변장치인 마우스와 키보드에 대해 알아보자.

### 마우스

옛날에는 PC방에 가면 포트리스나 스타크래프트, 디아블로 같은 게임을 했었다. 스타크래프트나 디아블로 같은 게임은 마우스 동작이 많이 필요한 게임이다. 이 때는 PC방 마우스가 볼 마우스라고 해서 마우스 밑에 공 같은 게 달려있었다. 마우스를 움직이면 이 볼이 마우스 밑에 있기 때문에 회전을 하게 되고 회전을 감지해서 움직임을 처리하는 방식이었다. 그런데 이 볼 마우스는 중간에 뭐가 껴서 잘 돌아가지도 않고  잔 고장이 많아 고장 난 마우스에 볼을 빼고 놀기도 했었다. 볼 마우스의 이러한 단점으로 요즘은 광학 마우스를 많이 쓴다. 광학 마우스는 아래쪽에 작은 카메라가 달려있다. 이 카메라가 표혐으로 초당 1500회 넘는 사진을 찍어 마우스의 디바이스 컨트롤러 내 DSP(Digital Signal Processor)로 보낸다. DSP는 이 사진을 분석해 마우스의 x축 좌표와 y축 좌표 움직임을 캐치한다. DSP가 마우스의 움직임과 클릭 같은 데이터를 감지하면 디바이스 컨트롤러는 CPU에게 인터럽트 신호를 보내고 마우스 드라이버가 동작해서 데이터를 읽어간다. 마우스 드라이버는 운영체제에게 이벤트 신호를 주는데 운영체제는 이 이벤트를 Foregorund 애플리케이션으로 전달해 주고 이 애플리케이션은 받은 마우스 이벤트를 처리한다.

### 키보드

이번에는 키보드에 대해 알아보자. 키보드는 마우스와 근본적인 움직임은 동일하다. 사용자가 키보드 버튼을 누르면 키보드의 디바이스 컨트롤러가 어떤 키를 입력 받았는지 알아낸다. 그리고 CPU에게 인터럽트를 보내고 키보드 드라이버는 운영체제에게 이벤트를 보낸다. 그럼 운영체제는 Foreground 애플리케이션에게 이벤트를 전달해 주고 이 애플리케이션은 해당 키에 맞는 동작을 수행한다.

> 이 포스트는 [감자님 강의](https://www.inflearn.com/course/%EB%B9%84%EC%A0%84%EA%B3%B5%EC%9E%90-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C/dashboard '인프런 강의')를 기반으로 작성되었습니다.

## 하드디스크 / Flash Memory(SSD)

이번 포스트에서 주변장치 중 블록 디바이스의 한 종류인 하드디스크를 알아보자.

### 하드디스크

하드디스크 구조에 대해 알아보자. 하드디스크에 스핀들이라는 막대가 있다. 스핀들에는 플래터라는 원판들이 붙어있다. 플래터는 자기화된 원판으로 이루어져 있는데 디스크 암이 읽기/쓰기 헤드로 플래터의 표면을 읽는다. 플래터는 여러 개의 트랙으로 구성되어 있고 표면의 자성이 있기 때문에 표면이 N극을 띄면 0, S극을 띄면 1로 인식한다. 보통 하드디스크의 플래터 수는 2개 이상이다. 헤드는 디스크 암에 고정되어 있기 때문에 모든 헤드는 항상 같이 움직인다. 헤드가 움직이면 이 헤드들은 여러 개의 플래터를 가리키게 되는데 이때 여러 개의 플래터에 있는 같은 트랙의 집합을 실린더라고 부른다. 트랙은 다시 여러 개의 섹터로 나뉘는데 이 섹터가 하드디스크의 가장 작은 단위이다.

그럼 하드디스크에서 데이터를 읽어오는 예시를 알아보자. 유저 프로세스가 하드디스크의 특정 섹터에 접근하고 싶어서 "실린더 C로 가서 트랙 B에 있는 섹터 D를 읽어!"라는 요청을 보낸다. 그럼 디스크 암은 헤드를 실린더 C로 이동시키는데 이를 "Seek"라고 부른다. 그리고 헤드를 실린더로 이동시키는데 걸리는 시간을 Seek Time이라고 부르는데 이것 때문에 하드디스크가 굉장히 느린 것이다. 헤드를 목표지점까지 움직이는 시간은 수 ms인데 다른 전자장비들은 ns단위로 움직이니까 상대적으로 굉장히 느린 것이다. 디스크 암을 실린더 C까지 보냈으면 트랙 B의 섹터 D가 헤드에 닿을 때까지 스핀들을 회전시킨다. 그러다가 헤드에 섹터 D가 읽히면 작업이 끝난다.

### Flash Memory(SSD)

이번에는 블록 디바이스의 또 다른 종류인 Flash Memory에 대해 알아보자. 요즘은 하드디스크보다 Flash Memory를 더 많이 사용한다. 데스크탑에서는 Flash Memory의 이점으로 많은 사람들이 SSD를 사용한다. 태블릿이나 휴대폰 기기 같은 경우는 하드디스크를 넣을 공간이 없어서 당연히 Flash Memory를 사용한다. 하드디스크는 기계적으로 헤드를 움직여 속도가 많이 느리고 소음도 발생하지만 Flash Memory는 전기적으로 읽기 때문에 굉장히 빠르고 조용하다. 또한 자기적으로 처리하는 하드디스크는 자석을 갖다 대면 데이터가 손상되지만 Flash Memory는 안전하다. 하드디스크는 스핀들처럼 회전축 같은 것이 있어서 충격에 매우 약하지만 Flash Memory는 그렇지 않다. Flash Memory의 큰 단점은 특정 지점에 데이터를 썼다면 덮어쓰기가 불가능하다. 똑같은 지점에 데이터를 쓰려면 기존에 있는 데이터를 지우고 새로 써야 하는데 Flash Memory는 지우기 가능한 횟수가 정해져 있다. 그래서 똑같은 지점에 지우기/쓰기를 계속하면 망가져서 사용이 불가능하다.
